import{d as C,w as D}from"./index.DbUG7Ea_.js";import{l as S}from"./localstorageWritable.DKj_D4gn.js";import{h as d}from"./scheduler.Bd7mgcTo.js";import{b as M,s as A,u as y,t as z,r as B}from"./index.n9lVo9DY.js";import{g as I,a as E}from"./entry.5DHIJE4I.js";import{b as U}from"./paths.BoepOE7F.js";const L=D(typeof navigator=="object"?navigator.onLine:!1),G=C(L,e=>e);function H(){return d(G)}function J(){L.set(!0)}function K(){L.set(!1)}window.addEventListener("online",J),window.addEventListener("offline",K);function Q(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var F={exports:{}};(function(e){var i=Object.prototype.hasOwnProperty,n="~";function t(){}Object.create&&(t.prototype=Object.create(null),new t().__proto__||(n=!1));function r(l,o,a){this.fn=l,this.context=o,this.once=a||!1}function v(l,o,a,c,b){if(typeof a!="function")throw new TypeError("The listener must be a function");var h=new r(a,c||l,b),f=n?n+o:o;return l._events[f]?l._events[f].fn?l._events[f]=[l._events[f],h]:l._events[f].push(h):(l._events[f]=h,l._eventsCount++),l}function m(l,o){--l._eventsCount===0?l._events=new t:delete l._events[o]}function p(){this._events=new t,this._eventsCount=0}p.prototype.eventNames=function(){var o=[],a,c;if(this._eventsCount===0)return o;for(c in a=this._events)i.call(a,c)&&o.push(n?c.slice(1):c);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(a)):o},p.prototype.listeners=function(o){var a=n?n+o:o,c=this._events[a];if(!c)return[];if(c.fn)return[c.fn];for(var b=0,h=c.length,f=new Array(h);b<h;b++)f[b]=c[b].fn;return f},p.prototype.listenerCount=function(o){var a=n?n+o:o,c=this._events[a];return c?c.fn?1:c.length:0},p.prototype.emit=function(o,a,c,b,h,f){var g=n?n+o:o;if(!this._events[g])return!1;var s=this._events[g],x=arguments.length,P,u;if(s.fn){switch(s.once&&this.removeListener(o,s.fn,void 0,!0),x){case 1:return s.fn.call(s.context),!0;case 2:return s.fn.call(s.context,a),!0;case 3:return s.fn.call(s.context,a,c),!0;case 4:return s.fn.call(s.context,a,c,b),!0;case 5:return s.fn.call(s.context,a,c,b,h),!0;case 6:return s.fn.call(s.context,a,c,b,h,f),!0}for(u=1,P=new Array(x-1);u<x;u++)P[u-1]=arguments[u];s.fn.apply(s.context,P)}else{var q=s.length,N;for(u=0;u<q;u++)switch(s[u].once&&this.removeListener(o,s[u].fn,void 0,!0),x){case 1:s[u].fn.call(s[u].context);break;case 2:s[u].fn.call(s[u].context,a);break;case 3:s[u].fn.call(s[u].context,a,c);break;case 4:s[u].fn.call(s[u].context,a,c,b);break;default:if(!P)for(N=1,P=new Array(x-1);N<x;N++)P[N-1]=arguments[N];s[u].fn.apply(s[u].context,P)}}return!0},p.prototype.on=function(o,a,c){return v(this,o,a,c,!1)},p.prototype.once=function(o,a,c){return v(this,o,a,c,!0)},p.prototype.removeListener=function(o,a,c,b){var h=n?n+o:o;if(!this._events[h])return this;if(!a)return m(this,h),this;var f=this._events[h];if(f.fn)f.fn===a&&(!b||f.once)&&(!c||f.context===c)&&m(this,h);else{for(var g=0,s=[],x=f.length;g<x;g++)(f[g].fn!==a||b&&!f[g].once||c&&f[g].context!==c)&&s.push(f[g]);s.length?this._events[h]=s.length===1?s[0]:s:m(this,h)}return this},p.prototype.removeAllListeners=function(o){var a;return o?(a=n?n+o:o,this._events[a]&&m(this,a)):(this._events=new t,this._eventsCount=0),this},p.prototype.off=p.prototype.removeListener,p.prototype.addListener=p.prototype.on,p.prefixed=n,p.EventEmitter=p,e.exports=p})(F);var R=F.exports;const V=Q(R),T=S("token",null),w=S("user",null),_=C(w,e=>e),X=C(w,e=>!!e),re=C(w,e=>(e==null?void 0:e.permissions.includes("admin"))===!0),k=new V;function se(){return d(X)}async function oe(e,i){const n=await z.createToken({grant_type:"password",username:e,password:i});return $(n)}async function ae(e,i,n,t){const r=await B.registerUser({username:e,password:i,password_confirmation:n});return $(r)}async function $(e){A(e);const i=await y.currentUser();return w.set(i),T.set(e),k.emit("user",i),i}async function ce(e){await y.updateUser(d(_).id,{username:e}),w.update(i=>i?{...i,username:e}:null),await E()}async function le(e){var i;await y.setPrimaryEmail((i=d(_))==null?void 0:i.id,e),w.update(n=>{if(n){const t=n.emails.findIndex(r=>r.id===e);if(t!==-1){const r=n.emails.slice(),v=r[t];return n.email?r[t]=n.email:r.splice(t,1),{...n,email:v,emails:r}}}return n}),await E()}async function fe(e){var i;await y.deleteEmail((i=d(_))==null?void 0:i.id,e),w.update(n=>{if(n){const t=n.emails.findIndex(r=>r.id===e);if(t!==-1){const r=n.emails.slice();return r.splice(t,1),{...n,emails:r}}}return n}),await E()}async function ue(e){var i;await y.sendConfirmationToEmail((i=d(_))==null?void 0:i.id,e)}async function me(e,i){var n;await y.confirmEmail((n=d(_))==null?void 0:n.id,e,{token:i}),w.update(t=>{var r;if(t){if(((r=t.email)==null?void 0:r.id)===e)return{...t,email:{...t.email,confirmed:!0}};const v=t.emails.findIndex(m=>m.id===e);if(v!==-1){const m=t.emails.slice();return m[v]={...m[v],confirmed:!0},{...t,emails:m}}}return t}),await E()}async function pe(e){var n;const i=await y.createEmail((n=d(_))==null?void 0:n.id,{email:e});return w.update(t=>{if(t){const r=t.emails.slice();return r.push(i),{...t,emails:r}}return t}),await E(),i}async function he(e){var i;await y.setPrimaryPhoneNumber((i=d(_))==null?void 0:i.id,e),w.update(n=>{if(n){const t=n.phone_numbers.findIndex(r=>r.id===e);if(t!==-1){const r=n.phone_numbers.slice(),v=r[t];return n.phone_number?r[t]=n.phone_number:r.splice(t,1),{...n,phone_number:v,phone_numbers:r}}}return n}),await E()}async function de(e){var i;await y.deletePhoneNumber((i=d(_))==null?void 0:i.id,e),w.update(n=>{if(n){const t=n.phone_numbers.findIndex(r=>r.id===e);if(t!==-1){const r=n.phone_numbers.slice();return r.splice(t,1),{...n,phone_numbers:r}}}return n}),await E()}async function we(e){var i;await y.sendConfirmationToPhoneNumber((i=d(_))==null?void 0:i.id,e)}async function ve(e,i){var n;await y.confirmPhoneNumber((n=d(_))==null?void 0:n.id,e,{token:i}),w.update(t=>{var r;if(t){if(((r=t.phone_number)==null?void 0:r.id)===e)return{...t,phone_number:{...t.phone_number,confirmed:!0}};const v=t.phone_numbers.findIndex(m=>m.id===e);if(v!==-1){const m=t.phone_numbers.slice();return m[v]={...m[v],confirmed:!0},{...t,phone_numbers:m}}}return t}),await E()}async function be(e){var n;const i=await y.createPhoneNumber((n=d(_))==null?void 0:n.id,{phone_number:e});return w.update(t=>{if(t){const r=t.phone_numbers.slice();return r.push(i),{...t,phone_numbers:r}}return t}),await E(),i}async function ye(e){var i;await y.removeUserFromApplication((i=d(_))==null?void 0:i.id,e)}function O(){w.set(null),T.set(null),A(void 0),k.emit("signOut")}let j=!0;async function _e(){try{let e=d(w);if(j){if(H()){const i=d(T);i?(A(i),e=await y.currentUser(),w.set(e),k.emit("user",e)):(O(),e=null)}else e&&k.emit("user",e);j=!1}return e}catch(e){return console.error(e),O(),null}}var W;(W=M.middleware)==null||W.push({async post(e){switch(e.response.status){case 401:O(),await I(`${U}/signin`);break;case 503:await I(`${U}/maintenance`)}}});export{V as E,ae as a,X as b,re as c,O as d,le as e,fe as f,_e as g,ue as h,se as i,me as j,pe as k,he as l,de as m,we as n,ve as o,be as p,ce as q,ye as r,oe as s};
