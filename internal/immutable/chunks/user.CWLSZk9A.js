import{d as E,w as F}from"./index.By0m1wDQ.js";import{l as I}from"./localstorageWritable.Doa7Mqqg.js";import{h as g}from"./scheduler.DfWX43tP.js";import{b as G,s as k,u as P,t as M,r as q}from"./index.BljgEkYd.js";import{g as U}from"./entry.PqAeg84Z.js";import{b as T}from"./paths.BVXwFHBQ.js";const C=F(typeof navigator=="object"?navigator.onLine:!1),z=E(C,e=>e);function B(){return g(z)}function H(){C.set(!0)}function J(){C.set(!1)}window.addEventListener("online",H),window.addEventListener("offline",J);function K(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var S={exports:{}};(function(e){var l=Object.prototype.hasOwnProperty,i="~";function y(){}Object.create&&(y.prototype=Object.create(null),new y().__proto__||(i=!1));function x(o,n,r){this.fn=o,this.context=n,this.once=r||!1}function A(o,n,r,s,p){if(typeof r!="function")throw new TypeError("The listener must be a function");var c=new x(r,s||o,p),a=i?i+n:n;return o._events[a]?o._events[a].fn?o._events[a]=[o._events[a],c]:o._events[a].push(c):(o._events[a]=c,o._eventsCount++),o}function w(o,n){--o._eventsCount===0?o._events=new y:delete o._events[n]}function f(){this._events=new y,this._eventsCount=0}f.prototype.eventNames=function(){var n=[],r,s;if(this._eventsCount===0)return n;for(s in r=this._events)l.call(r,s)&&n.push(i?s.slice(1):s);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(r)):n},f.prototype.listeners=function(n){var r=i?i+n:n,s=this._events[r];if(!s)return[];if(s.fn)return[s.fn];for(var p=0,c=s.length,a=new Array(c);p<c;p++)a[p]=s[p].fn;return a},f.prototype.listenerCount=function(n){var r=i?i+n:n,s=this._events[r];return s?s.fn?1:s.length:0},f.prototype.emit=function(n,r,s,p,c,a){var v=i?i+n:n;if(!this._events[v])return!1;var t=this._events[v],h=arguments.length,d,u;if(t.fn){switch(t.once&&this.removeListener(n,t.fn,void 0,!0),h){case 1:return t.fn.call(t.context),!0;case 2:return t.fn.call(t.context,r),!0;case 3:return t.fn.call(t.context,r,s),!0;case 4:return t.fn.call(t.context,r,s,p),!0;case 5:return t.fn.call(t.context,r,s,p,c),!0;case 6:return t.fn.call(t.context,r,s,p,c,a),!0}for(u=1,d=new Array(h-1);u<h;u++)d[u-1]=arguments[u];t.fn.apply(t.context,d)}else{var D=t.length,_;for(u=0;u<D;u++)switch(t[u].once&&this.removeListener(n,t[u].fn,void 0,!0),h){case 1:t[u].fn.call(t[u].context);break;case 2:t[u].fn.call(t[u].context,r);break;case 3:t[u].fn.call(t[u].context,r,s);break;case 4:t[u].fn.call(t[u].context,r,s,p);break;default:if(!d)for(_=1,d=new Array(h-1);_<h;_++)d[_-1]=arguments[_];t[u].fn.apply(t[u].context,d)}}return!0},f.prototype.on=function(n,r,s){return A(this,n,r,s,!1)},f.prototype.once=function(n,r,s){return A(this,n,r,s,!0)},f.prototype.removeListener=function(n,r,s,p){var c=i?i+n:n;if(!this._events[c])return this;if(!r)return w(this,c),this;var a=this._events[c];if(a.fn)a.fn===r&&(!p||a.once)&&(!s||a.context===s)&&w(this,c);else{for(var v=0,t=[],h=a.length;v<h;v++)(a[v].fn!==r||p&&!a[v].once||s&&a[v].context!==s)&&t.push(a[v]);t.length?this._events[c]=t.length===1?t[0]:t:w(this,c)}return this},f.prototype.removeAllListeners=function(n){var r;return n?(r=i?i+n:n,this._events[r]&&w(this,r)):(this._events=new y,this._eventsCount=0),this},f.prototype.off=f.prototype.removeListener,f.prototype.addListener=f.prototype.on,f.prefixed=i,f.EventEmitter=f,e.exports=f})(S);var Q=S.exports;const R=K(Q),L=I("token",null),m=I("user",null),N=E(m,e=>e),V=E(m,e=>!!e),re=E(m,e=>(e==null?void 0:e.permissions.includes("admin"))===!0),b=new R;function se(e){var l;((l=g(N))==null?void 0:l.id)===e.id&&m.update(i=>i?{...i,...e}:null)}function oe(){return g(V)}function ie(){return g(N)}async function ae(e,l){const i=await M.createToken({grant_type:"password",username:e,password:l});return $(i)}async function ue(e,l,i,y){const x=await q.registerUser({username:e,password:l,password_confirmation:i});return $(x)}async function $(e){k(e);const l=await P.currentUser();return m.set(l),L.set(e),b.emit("user",l),l}function O(){m.set(null),L.set(null),k(void 0),b.emit("signOut")}let W=!0;async function fe(){try{let e=g(m);if(W){if(B()){const l=g(L);l?(k(l),e=await P.currentUser(),m.set(e),b.emit("user",e)):(O(),e=null)}else e&&b.emit("user",e);W=!1}return e}catch(e){return console.error(e),O(),null}}var j;(j=G.middleware)==null||j.push({async post(e){switch(e.response.status){case 401:O(),await U(`${T}/signin`);break;case 503:await U(`${T}/maintenance`)}}});export{R as E,ue as a,V as b,re as c,O as d,N as e,ie as g,oe as i,ae as s,fe as t,se as u};
