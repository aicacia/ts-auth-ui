import{d as E,w as D}from"./index.6SKR3riS.js";import{l as I}from"./localstorageWritable.Dpe8MAez.js";import{e as d}from"./scheduler.Co-indjX.js";import{b as F,s as k,c as P,t as G,r as M}from"./index.S6EU6auF.js";import{g as U}from"./entry.Dfa5j_51.js";import{b as T}from"./paths.C24qRk1J.js";const C=D(typeof navigator=="object"?navigator.onLine:!1),q=E(C,e=>e);function z(){return d(q)}function B(){C.set(!0)}function H(){C.set(!1)}window.addEventListener("online",B),window.addEventListener("offline",H);function J(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var S={exports:{}};(function(e){var p=Object.prototype.hasOwnProperty,u="~";function g(){}Object.create&&(g.prototype=Object.create(null),new g().__proto__||(u=!1));function x(o,n,r){this.fn=o,this.context=n,this.once=r||!1}function A(o,n,r,s,l){if(typeof r!="function")throw new TypeError("The listener must be a function");var f=new x(r,s||o,l),i=u?u+n:n;return o._events[i]?o._events[i].fn?o._events[i]=[o._events[i],f]:o._events[i].push(f):(o._events[i]=f,o._eventsCount++),o}function w(o,n){--o._eventsCount===0?o._events=new g:delete o._events[n]}function c(){this._events=new g,this._eventsCount=0}c.prototype.eventNames=function(){var n=[],r,s;if(this._eventsCount===0)return n;for(s in r=this._events)p.call(r,s)&&n.push(u?s.slice(1):s);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(r)):n},c.prototype.listeners=function(n){var r=u?u+n:n,s=this._events[r];if(!s)return[];if(s.fn)return[s.fn];for(var l=0,f=s.length,i=new Array(f);l<f;l++)i[l]=s[l].fn;return i},c.prototype.listenerCount=function(n){var r=u?u+n:n,s=this._events[r];return s?s.fn?1:s.length:0},c.prototype.emit=function(n,r,s,l,f,i){var v=u?u+n:n;if(!this._events[v])return!1;var t=this._events[v],h=arguments.length,m,a;if(t.fn){switch(t.once&&this.removeListener(n,t.fn,void 0,!0),h){case 1:return t.fn.call(t.context),!0;case 2:return t.fn.call(t.context,r),!0;case 3:return t.fn.call(t.context,r,s),!0;case 4:return t.fn.call(t.context,r,s,l),!0;case 5:return t.fn.call(t.context,r,s,l,f),!0;case 6:return t.fn.call(t.context,r,s,l,f,i),!0}for(a=1,m=new Array(h-1);a<h;a++)m[a-1]=arguments[a];t.fn.apply(t.context,m)}else{var $=t.length,_;for(a=0;a<$;a++)switch(t[a].once&&this.removeListener(n,t[a].fn,void 0,!0),h){case 1:t[a].fn.call(t[a].context);break;case 2:t[a].fn.call(t[a].context,r);break;case 3:t[a].fn.call(t[a].context,r,s);break;case 4:t[a].fn.call(t[a].context,r,s,l);break;default:if(!m)for(_=1,m=new Array(h-1);_<h;_++)m[_-1]=arguments[_];t[a].fn.apply(t[a].context,m)}}return!0},c.prototype.on=function(n,r,s){return A(this,n,r,s,!1)},c.prototype.once=function(n,r,s){return A(this,n,r,s,!0)},c.prototype.removeListener=function(n,r,s,l){var f=u?u+n:n;if(!this._events[f])return this;if(!r)return w(this,f),this;var i=this._events[f];if(i.fn)i.fn===r&&(!l||i.once)&&(!s||i.context===s)&&w(this,f);else{for(var v=0,t=[],h=i.length;v<h;v++)(i[v].fn!==r||l&&!i[v].once||s&&i[v].context!==s)&&t.push(i[v]);t.length?this._events[f]=t.length===1?t[0]:t:w(this,f)}return this},c.prototype.removeAllListeners=function(n){var r;return n?(r=u?u+n:n,this._events[r]&&w(this,r)):(this._events=new g,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=u,c.EventEmitter=c,e.exports=c})(S);var K=S.exports;const Q=J(K),L=I("token",null),y=I("user",null),R=E(y,e=>e),V=E(y,e=>!!e);E(y,e=>(e==null?void 0:e.permissions.includes("admin"))===!0);const b=new Q;function re(){return d(V)}function se(){return d(R)}async function oe(e,p){const u=await G.createToken({grant_type:"password",username:e,password:p});return N(u)}async function ie(e,p,u,g){const x=await M.registerUser({username:e,password:p,password_confirmation:u});return N(x)}async function N(e){k(e);const p=await P.currentUser();return y.set(p),L.set(e),b.emit("user",p),p}function O(){y.set(null),L.set(null),k(void 0),b.emit("signOut")}let W=!0;async function ae(){try{let e=d(y);if(W){if(z()){const p=d(L);p?(k(p),e=await P.currentUser(),y.set(e),b.emit("user",e)):(O(),e=null)}else e&&b.emit("user",e);W=!1}return e}catch(e){return console.error(e),O(),null}}var j;(j=F.middleware)==null||j.push({async post(e){switch(e.response.status){case 401:O(),await U(`${T}/signin`);break;case 503:await U(`${T}/maintenance`)}}});export{Q as E,ie as a,V as b,O as c,se as g,re as i,oe as s,ae as t};
